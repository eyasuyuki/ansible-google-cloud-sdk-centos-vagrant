<source>
  type forward
</source>

<source>
  type debug_agent
  bind 127.0.0.1
  port 24230
</source>

<source>
  type exec
  tag apache
  format json
  command /opt/td-agent/embedded/bin/apache-loggen --json
</source>

<match debug.**>
  type stdout
</match>

<match apache.**>
  type copy
  <store>
    type google_cloud_storage
    service_email YOUR_PROJECT_EMAIL
    service_pkcs12_path /etc/td-agent/example.p12
    project_id YOUR_PROJECT_ID
    bucket_id YOUR_BUCKET_ID
    path %Y/%m/%d/access_log.${chunk_id}.json
    buffer_type memory
    buffer_path /var/log/td-agent/buffer
  </store>
  <store>
    type bigquery
    method insert
    auth_method private_key
    email YOUR_PROJECT_EMAIL
    private_key_path /etc/td-agent/example.p12
    project YOUR_PORJECT_ID
    dataset YOUR_DATASET_NAME
    auto_create_table true
    table access_log%Y%m%d
    schema_path /etc/td-agent/access_log.json
    time_field time
    buffer_chunk_limit 768k
    buffer_queue_limit 5000
    flush_interval 1s
    try_flush_interval 0.05
    num_threads 20
    queue_chunk_flush_interval 0.01
#    insert_id_field uuid
#    field_string uuid
    retry_limit 15
    buffer_chunk_record_limit 300
  </store>
</match>
